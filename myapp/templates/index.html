{% extends 'basic.html' %}

{% block content %}
  {% load static %}

  <div id="header-carousel" class="carousel slide mt-5" data-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active" style="height: 75vh;">
        <img class="img-fluid" src="{% static 'img/carousel-1.jpg' %}" alt="Image" />
        <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
          <div class="p-3" style="max-width: 700px;">
            <h4 class="text-light text-uppercase font-weight-medium mb-3"></h4>
            <h3 class="display-4 text-white font-weight-semi-bold mb-4">Fashionable Dress</h3>
            <a href="{% url 'Shop' %}" class="btn btn-primary py-2 px-3">Shop Now</a> 
          </div>
        </div>
      </div>
      <div class="carousel-item" style="height: 75vh;">
        <img class="img-fluid" src="{% static 'img/carousel-2.jpg' %}" alt="Image" />
        <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
          <div class="p-3" style="max-width: 700px;">
            <h4 class="text-light text-uppercase font-weight-medium mb-3"></h4>
            <h3 class="display-4 text-white font-weight-semi-bold mb-4">Reasonable Price</h3>
             <a href="{% url 'Shop' %}" class="btn btn-primary py-2 px-3">Shop Now</a> 
          </div>
        </div>
      </div>
    </div>
    <a class="carousel-control-prev" href="#header-carousel" data-slide="prev">
      <div class="btn btn-dark" style="width: 45px; height: 45px;">
        <span class="carousel-control-prev-icon mb-n2"></span>
      </div>
    </a>
    <a class="carousel-control-next" href="#header-carousel" data-slide="next">
      <div class="btn btn-dark" style="width: 45px; height: 45px;">
        <span class="carousel-control-next-icon mb-n2"></span>
      </div>
    </a>
  </div>

  <!-- Featured Start -->
  <div class="container-fluid pt-5">
    <div class="row px-xl-5 pb-3">
      <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
        <div class="d-flex align-items-center border mb-4" style="padding: 30px;">
          <h1 class="fa fa-check text-primary m-0 mr-3"></h1>
          <h5 class="font-weight-semi-bold m-0">Quality Product</h5>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
        <div class="d-flex align-items-center border mb-4" style="padding: 30px;">
          <h1 class="fa fa-shipping-fast text-primary m-0 mr-2"></h1>
          <h5 class="font-weight-semi-bold m-0">Free Shipping</h5>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
        <div class="d-flex align-items-center border mb-4" style="padding: 30px;">
          <h1 class="fas fa-exchange-alt text-primary m-0 mr-3"></h1>
          <h5 class="font-weight-semi-bold m-0">14-Day Return</h5>
        </div>
      </div>
      <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
        <div class="d-flex align-items-center border mb-4" style="padding: 30px;">
          <h1 class="fa fa-phone-volume text-primary m-0 mr-3"></h1>
          <h5 class="font-weight-semi-bold m-0">24/7 Support</h5>
        </div>
      </div>
    </div>
  </div>
  <!-- Featured End -->

  <!-- Categories Start -->
    <div class="container-fluid pt-0">
      <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner">
              {% for subcategory_group in subcategories %}
              <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <div class="row">
                    {% for subcategory in subcategory_group %}
                    {% if subcategory %}
                    <div class="col-md-4">
                        <div class="cat-item d-flex flex-column border mb-4" style="padding: 30px;">
                            <p class="text-right">{{ subcategory.product_count }} Products</p>
                            <a href="{% url 'shop' subcategory.s_id %}" class="cat-img position-relative overflow-hidden mb-3"><img class="img-fluid" src="{{ subcategory.SubCategory_Image.url }}" alt="" /></a>
                            <h5 class="font-weight-semi-bold m-0">{{ subcategory.c_id.Category_Name }} - {{ subcategory.Subcategory_Name }}</h5>
                        </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>
              {% endfor %}
          </div>
          <a class="carousel-control-prev justify-content-between " href="#carouselExampleIndicators" role="button" data-slide="prev">
            <div class="btn btn-dark" style="width: 45px; height: 45px;">
              <span class="carousel-control-prev-icon mb-n2"></span>
            </div>
          </a>
          <a class="carousel-control-next justify-content-end " href="#carouselExampleIndicators" role="button" data-slide="next">
            <div class="btn btn-dark" style="width: 45px; height: 45px;">
              <span class="carousel-control-next-icon mb-n2"></span>
            </div>
          </a>
      </div>
    </div>
  <!-- Categories End -->

  <!-- Offer Start -->
  <div class="container-fluid offer pt-5">
    <div class="row px-xl-5">
      <div class="col-md-6 pb-4">
        <div class="position-relative bg-secondary text-center text-md-right text-white mb-2 py-5 px-5">
          <img src="{% static 'img/offer-1.png' %}" alt="" />
          <div class="position-relative" style="z-index: 1;">
            <h5 class="text-uppercase text-primary mb-3">20% off the all order</h5>
            <h1 class="mb-4 font-weight-semi-bold">Spring Collection</h1>
            <!-- <a href="" class="btn btn-outline-primary py-md-2 px-md-3">Shop Now</a> -->
          </div>
        </div>
      </div>
      <div class="col-md-6 pb-4">
        <div class="position-relative bg-secondary text-center text-md-left text-white mb-2 py-5 px-5">
          <img src="{% static 'img/offer-2.png' %}" alt="" />
          <div class="position-relative" style="z-index: 1;">
            <h5 class="text-uppercase text-primary mb-3">20% off the all order</h5>
            <h1 class="mb-4 font-weight-semi-bold">Winter Collection</h1>
            <!-- <a href="" class="btn btn-outline-primary py-md-2 px-md-3">Shop Now</a> -->
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Offer End -->

  <!-- Trendy Products Start -->
  <div class="container-fluid pt-5">
    <div class="text-center mb-4">
      <h2 class="section-title px-5"><span class="px-2">Trendy Products</span></h2>
    </div>
    <div class="owl-carousel owl-theme">
      {% for i in products %}
      <div class="item">
        {% csrf_token %}
        <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
          <div class="card product-item border-0 mb-4">
            <i id="wishlist-icon" class="far fa-heart wishlist-btn {% if i.p_id in wishlist_ids %}fas active{% else %}far{% endif %}" data-productid="{{ i.p_id }}"></i>

            <div class="card-header product-img position-relative overflow-hidden bg-transparent border p-0">
              <img class="img-fluid w-100" src="{{ i.Pro_Image.url }}" alt="" />
            </div>
            <div class="card-body border-left border-right text-center p-0 pt-4 pb-3">
              <h6 class="text-truncate mb-3">{{ i.Pro_Name }}</h6>
              <div class="d-flex justify-content-center">
                <h6>{{ i.Pro_Price }}</h6>
              </div>
            </div>
            <div class="card-footer d-flex justify-content-between bg-light border">
              {% comment %} <button class="btn btn-sm text-dark p-0 addtowishlist" data-pid="{{ i.p_id }}"><i class="fa fa-eye mr-1"></i></button> {% endcomment %}
              <a href="{% url 'detail' i.p_id %}" class="btn btn-sm text-dark p-0"><i class="fas fa-eye text-primary mr-1"></i>View Detail</a>
              <button class="btn btn-sm text-dark p-0 add-to-cart" data-pid="{{ i.p_id }}"><i class="fa fa-shopping-cart text-primary mr-1"></i> Add To Cart</button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
  </div>
  
  
    <div class="row px-xl-5 pb-3">
      {% for i in products %}
        {% csrf_token %}
        <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
          <div class="card product-item border-0 mb-4">
            <i id="wishlist-icon" class="far fa-heart wishlist-btn {% if i.p_id in wishlist_ids %}fas active{% else %}far{% endif %}" data-productid="{{ i.p_id }}"></i>

            <div class="card-header product-img position-relative overflow-hidden bg-transparent border p-0">
              <img class="img-fluid w-100" src="{{ i.Pro_Image.url }}" alt="" />
            </div>
            <div class="card-body border-left border-right text-center p-0 pt-4 pb-3">
              <h6 class="text-truncate mb-3">{{ i.Pro_Name }}</h6>
              <div class="d-flex justify-content-center">
                <h6>{{ i.Pro_Price }}</h6>
              </div>
            </div>
            <div class="card-footer d-flex justify-content-between bg-light border">
              {% comment %} <button class="btn btn-sm text-dark p-0 addtowishlist" data-pid="{{ i.p_id }}"><i class="fa fa-eye mr-1"></i></button> {% endcomment %}
              <a href="{% url 'detail' i.p_id %}" class="btn btn-sm text-dark p-0"><i class="fas fa-eye text-primary mr-1"></i>View Detail</a>
              <button class="btn btn-sm text-dark p-0 add-to-cart" data-pid="{{ i.p_id }}"><i class="fa fa-shopping-cart text-primary mr-1"></i> Add To Cart</button>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    <div class="col-12 pb-1">
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mb-3">
          {% if products.has_previous %}
          <li class="page-item">
              <a class="page-link" href="?page={{ products.previous_page_number }}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                  <span class="sr-only">Previous</span>
              </a>
          </li>
          {% endif %}
          {% for i in products.paginator.page_range %}
          <li class="page-item {% if products.number == i %}active{% endif %}"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
          {% endfor %}
          {% if products.has_next %}
          <li class="page-item">
              <a class="page-link" href="?page={{ products.next_page_number }}" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                  <span class="sr-only">Next</span>
              </a>
          </li>
          {% endif %}
        </ul>
      </nav>
  </div>
  </div>
  <!-- Trendy Products End -->

  <!-- Just Arrived Products Start -->
  <div class="container-fluid pt-5">
    <div class="text-center mb-4">
      <h2 class="section-title px-5"><span class="px-2">Just Arrived</span></h2>
    </div>
    <div class="row px-xl-5 pb-3">
      {% for i in products %}
        <div class="col-lg-3 col-md-6 col-sm-12 pb-1">
          <div class="card product-item border-0 mb-4">
            <i id="wishlist-icon" class="far fa-heart wishlist-btn {% if i.p_id in wishlist_ids %}fas active{% else %}far{% endif %}" data-productid="{{ i.p_id }}"></i>
            <div class="card-header product-img position-relative overflow-hidden bg-transparent border p-0">
              <img class="img-fluid w-100" src="{{ i.Pro_Image.url }}" alt="" />
            </div>
            <div class="card-body border-left border-right text-center p-0 pt-4 pb-3">
              <h6 class="text-truncate mb-3">{{ i.Pro_Name }}</h6>
              <div class="d-flex justify-content-center">
                <h6>{{ i.Pro_Price }}</h6>
              </div>
            </div>
            <div class="card-footer d-flex justify-content-between bg-light border">
              <a href="{% url 'detail' i.p_id %}" class="btn btn-sm text-dark p-0"><i class="fas fa-eye text-primary mr-1"></i>View Detail</a>
              <a href="{% url 'cart' %}" class="btn btn-sm text-dark p-0"><i class="fas fa-shopping-cart text-primary mr-1"></i>Add To Cart</a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    <div class="col-12 pb-1">
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mb-3">
          {% if products.has_previous %}
          <li class="page-item">
              <a class="page-link" href="?page={{ products.previous_page_number }}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                  <span class="sr-only">Previous</span>
              </a>
          </li>
          {% endif %}
          {% for i in products.paginator.page_range %}
          <li class="page-item {% if products.number == i %}active{% endif %}"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
          {% endfor %}
          {% if products.has_next %}
          <li class="page-item">
              <a class="page-link" href="?page={{ products.next_page_number }}" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                  <span class="sr-only">Next</span>
              </a>
          </li>
          {% endif %}
        </ul>
      </nav>
  </div>
  </div>
  <!-- Just Arrived Products End -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
  
  <script>
    
        document.querySelectorAll('.wishlist-btn').forEach(function(wishlistIcon) {
            wishlistIcon.addEventListener('click', function() {
                this.classList.toggle('far');
                this.classList.toggle('fas');
                this.classList.toggle('active');
                var productId = this.dataset.productid;

                $.ajax({
                  url: '/toggle_wishlist',  // the endpoint
                  type: "POST", // http method
                  data: {
                      product_id: productId,
                      csrfmiddlewaretoken: '{{ csrf_token }}'
                  }, // data sent with the post request
      
                  // handle a successful response
                  success: function(json) {
                      console.log(json); // log the returned json to the console
                      if (!json.Status) {
                          window.location.href = json.redirect_url;  // redirect to login page if not logged in
                      }
                  },
      
                  // handle a non-successful response
                  error: function(xhr, errmsg, err) {
                      console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
                  }
              });
            });
        });
        
        
        
        document.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', function() {
                var quantity = 1;
                var p_id = this.dataset.pid; 
        
                var csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

                var formdata = {
                    'p_id': p_id,
                    'Quantity': quantity
                };
                console.log(formdata);
                $.ajax({
                    url:'/add_to_cart',
                    method:'POST',
                    contentType:'application/json',
                    headers : {
                        'X-CSRFToken':csrfToken
                    },
                    data:JSON.stringify(formdata),
                    success:function(data){
                        if (data.Status) {
                            window.location.href = data.redirect_url;
                        } else {
                            if (data.redirect_url) {
                                window.location.href = data.redirect_url;
                            }
                        }
                    },
                    error:function(error){
                        var errorMsg = JSON.parse(jqXHR.responseText);
                        alert('Error occurred: ' + errorMsg.Msg);
                        if (errorMsg.redirect_url) {
                            window.location.href = errorMsg.redirect_url;
                        }
                    }
                });
            });
        });
        
        </script>
{% endblock %}
